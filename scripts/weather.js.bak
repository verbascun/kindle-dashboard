Dashboard.updateWeather = function() {
  var lat = DASHBOARD_CONFIG.latitude;
  var lon = DASHBOARD_CONFIG.longitude;
  var tz  = DASHBOARD_CONFIG.timezone;

  // Request both current and 7-day daily forecast

var dailyParams = [
  'temperature_2m_max',
  'temperature_2m_min',
  'precipitation_sum',
  'weathercode',
  'precipitation_probability_max'
].join(',');

var apiUrl = 'https://api.open-meteo.com/v1/forecast?' +
  'latitude=' + encodeURIComponent(lat) +
  '&longitude=' + encodeURIComponent(lon) +
  '&current_weather=true' +
  '&daily=' + encodeURIComponent(dailyParams) +
  '&timezone=' + encodeURIComponent(tz);

  var xhr = new XMLHttpRequest();
  xhr.open('GET', apiUrl, true);

  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        try {
          var data = JSON.parse(xhr.responseText);
          Dashboard.renderWeather(data);
        } catch (e) {
          console.log('Weather JSON parse error:', e);
        }
      } else {
        console.log('Weather request failed:', xhr.status);
      }
    }
  };

  xhr.send();
};





// Render current and forecast
Dashboard.renderWeather = function(data) {
  var weather = data.current_weather;
  var tempEl = document.getElementById('current-temperature');
  var windEl = document.getElementById('current-wind-speed');
  var iconEl = document.getElementById('weather-icon');
  
  var iconEl = document.getElementById('weather-icon');
  if (tempEl) tempEl.textContent = weather.temperature + '°C';
  if (windEl) windEl.textContent = weather.windspeed + ' km/h';

  // #TODO add svg icons for the weather
  if (iconEl) iconEl.src = '/icons/weather/' + weather.weathercode + '.svg';

  // 7-day forecast
  var fc = document.getElementById('forecast');
  if (!fc) return;

  fc.innerHTML = '';
  var days = data.daily.time.length;

  console.log (data);

var table = document.createElement('table'); // Create table element

var daysRow = document.createElement('tr'); // create days row

var nextSevenDays = getNextSevenDays() // Get the names of the next 6 days

for (var i = 0; i < days; i++) {
  var th = document.createElement('th');
  var dateArray = data.daily.time[i].split('-')
  if (i == 0) {
    th.innerHTML = dateArray[2] 
      + "/" + dateArray[1]
      + "<br> Today";
  } else {
    th.innerHTML = dateArray[2] 
      + "/" + dateArray[1]
    + "<br>" + nextSevenDays[i];
  } 
  
  daysRow.appendChild(th); // append th to row
}
table.appendChild(daysRow); // append row to table


var tempMaxRow = document.createElement('tr'); // create max temp row

for (var i = 0; i < days; i++) {
  var th = document.createElement('th');
  th.innerHTML = data.daily.temperature_2m_max[i] + '°'
  tempMaxRow.appendChild(th); // append th to row
  } 
table.appendChild(tempMaxRow); // append row to table
 
var tempMinRow = document.createElement('tr'); // create min temp row
 
for (var i = 0; i < days; i++) {
  var th = document.createElement('th');
  th.innerHTML = data.daily.temperature_2m_min[i] + '°'
  tempMinRow.appendChild(th); // append th to row
  } 
table.appendChild(tempMinRow); // append row to table


var precipitationSumRow = document.createElement('tr'); // create precipitation sum row

for (var i = 0; i < days; i++) {
  var th = document.createElement('th');
  th.innerHTML = data.daily.precipitation_sum[i] + ' mm'
  precipitationSumRow.appendChild(th); // append th to row
  } 
table.appendChild(precipitationSumRow); // append row to table

var precipitationProbabilityRow = document.createElement('tr'); // create precipitation sum row

for (var i = 0; i < days; i++) {
  var th = document.createElement('th');
  th.innerHTML = data.daily.precipitation_probability_max[i] + '%'
  precipitationProbabilityRow.appendChild(th); // append th to row
  } 
table.appendChild(precipitationProbabilityRow); // append row to table

fc.appendChild(table);


  // for (var i = 0; i < days; i++) {
  //   var dayDiv = document.createElement('div');
  //   dayDiv.className = 'forecast-day';
  //   dayDiv.innerHTML =
  //     '<p>' + data.daily.time[i] + '</p>' +
  //     '<img src="/icons/weather/' + data.daily.weathercode[i] + '.svg" alt="">' +
  //     '<p>' + data.daily.temperature_2m_max[i] + '° / ' + data.daily.temperature_2m_min[i] + '°</p>' +
  //     '<p>' + data.daily.precipitation_sum[i] + ' mm</p>';
  //   fc.appendChild(dayDiv);
  // }
};



function getNextSevenDays() {
// Day names in English
var dayNamesEn = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

// Optional: day names in Polish
var dayNamesPl = ['Niedziela', 'Poniedziałek', 'Wtorek', 'Środa', 'Czwartek', 'Piątek', 'Sobota'];

// Get today
var today = new Date();
var todayIndex = today.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday

// Generate next 7 day names
var next7DaysEn = [];
for (var i = 0; i < 7; i++) {
  var index = (todayIndex + i) % 7; // wrap around the week
  next7DaysEn.push(dayNamesEn[index]);
}

var next7DaysBoth = [];
for (var i = 0; i < 7; i++) {
  var index = (todayIndex + i) % 7; // wrap around the week
  next7DaysBoth.push({
    en: dayNamesEn[index],
    pl: dayNamesPl[index]
  });
}

return next7DaysEn

}
